<!DOCTYPE html>
<html>
<head>
    <script src="lib/jquery.min.js"></script>
    <script src="lib/bootstrap.bundle.min.js"></script>
    <script src="lib/bootstrap-slider.min.js"></script>
    <!-- css -->
    <link rel="stylesheet" href="lib/font-awesome.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="lib/bootstrap.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="lib/cropper.min.css">
    <link rel="stylesheet" href="lib/bootstrap-slider.min.css">
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- twitter tags-->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@8bitworkshop">
    <meta name="twitter:creator" content="@8bitworkshop">
    <meta name="twitter:image" content="https://8bitworkshop.com/blog/images/ide/dithertron-compare.png">
    <meta name="twitter:title" content="Dithertron by 8bitworkshop">
    <meta name="twitter:description" content="Crop, reduce, and dither images to 8-bit retro formats.">
    <title>Dithertron</title>
    <!-- local CSS -->
    <style type="text/css" media="screen">
        /* Footer styles - fixed at bottom of viewport */
        .page-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            padding: 0.5rem 1rem;
            color: #6c757d;
            font-size: 0.85rem;
            background: rgba(255,255,255,0.95);
            border-top: 1px solid #dee2e6;
            z-index: 1000;
        }
        .page-footer a {
            color: #6c757d;
            text-decoration: none;
        }
        .page-footer a:hover {
            color: #343a40;
            text-decoration: underline;
        }
        .footer-separator {
            margin: 0 0.5rem;
            color: #adb5bd;
        }
        .page-footer .dropdown-menu {
            font-size: 0.85rem;
        }
        .page-footer .dropdown-item img {
            height: 2em;
            margin-right: 0.5rem;
        }
        .dropup-caret::after {
            transform: rotate(180deg);
        }
        /* Custom CSS to make the container full-screen on desktop */
        @media (min-width: 768px) {
            .full-screen-container {
                height: 100vh;
                display: flex;
                align-items: center;
            }
            .container-xl {
                height: 100vh;
                display: flex;
                flex-direction: column;
                padding-bottom: 3rem; /* Space for fixed footer */
            }
            .responsive-row {
                display: flex;
                height: 50vh;
            }
            .responsive-col {
                display: flex;
                flex-direction: column;
            }
        }
        /* Main layout structure */
        .container-xl {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding-bottom: 2.5rem; /* Space for fixed footer */
            max-width: 100%; /* Full viewport width */
            width: 100%;
        }
        .main-layout {
            display: flex;
            flex: 1;
            gap: 1rem; /* Gutter between columns */
            min-height: 0; /* Allow flex children to shrink */
            padding: 0 1rem;
        }
        .layout-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0; /* Allow flex children to shrink */
        }
        /* Third column for system info and palette */
        .info-column {
            flex: 0 0 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 0.5rem;
            min-width: 100px;
            max-width: 140px;
        }
        .info-panel {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .system-name-display {
            font-size: 0.85rem;
            font-weight: 600;
            color: #333;
            word-break: break-word;
        }
        .format-info {
            font-size: 0.75rem;
            color: #6c757d;
            line-height: 1.3;
        }
        .palette-swatches-vertical {
            column-count: 3;
            column-gap: 4px;
        }
        .column-top {
            flex-shrink: 0;
        }
        .column-top .alert {
            margin-bottom: 0.5rem;
        }
        .column-image {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 0; /* Critical for flex shrinking */
            overflow: hidden;
            padding: 0 0.75rem; /* Match alert panel horizontal padding for alignment */
        }
        .image-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .column-bottom {
            flex-shrink: 0;
        }
        .column-bottom .alert {
            margin-bottom: 0;
            margin-top: 0;
            min-height: 160px;
        }

        /* Source image (cropper) - preserve aspect ratio within container */
        .image-container:not(.rendered-container) {
            align-items: center;
            justify-content: center;
            background: #f8f8f8;
        }
        img.crop {
            display: block;
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
        }
        /* Cropper.js container should respect image size */
        .cropper-container {
            max-width: 100% !important;
            max-height: 100% !important;
        }
        /* Override cropper.js grid background */
        .cropper-bg {
            background-image: none;
            background-color: #f8f8f8;
        }

        /* Rendered image (canvas) - scale to fill while maintaining aspect ratio */
        .rendered-container {
            align-items: center;
            justify-content: center;
            background: #f8f8f8;
        }
        .rendered-canvas {
            display: block;
            max-width: 100%;
            max-height: 100%;
            /* Width/height set dynamically by JS based on container aspect ratio */
        }
        /* Palette controls */
        .palette-controls {
            display: flex;
            gap: 0.25rem;
        }
        .palette-controls .btn {
            font-size: 0.7rem;
            padding: 0.2rem 0.4rem;
        }
        #booksMenu {
            background-color: #666;
            border-radius: 0.5em;
        }
        #booksMenu > a {
            color: #fff;
        }
        #examplesMenu {
            font-size: 0.8em;
        }
        /* Source controls - dropdown and file input on one line */
        .source-controls {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-wrap: wrap;
        }
        .source-controls input[type="file"] {
            font-size: 0.85rem;
        }
        /* Navbar layout - title left, buttons centered */
        .navbar {
            display: flex;
            align-items: center;
        }
        .navbar-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }
        .navbar-divider {
            width: 1px;
            height: 24px;
            background-color: #ccc;
            margin: 0 0.25rem;
        }
        .file-input-sm {
            font-size: 0.8rem;
            max-width: 180px;
        }
        /* Compact alert styling */
        .column-top .alert,
        .column-bottom .alert {
            padding: 0.5rem 0.75rem;
        }
        /* Crop toggle button */
        #cropToggle.active {
            background: #007bff;
            border-color: #007bff;
            color: #fff;
        }

        /* Error function buttons */
        .error-func-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
        }
        .error-func-btn {
            padding: 0.2rem 0.5rem;
            font-size: 0.7rem;
            background: #495057;
            border: 1px solid #6c757d;
            color: #fff;
            border-radius: 0.25rem;
            cursor: pointer;
            white-space: nowrap;
        }
        .error-func-btn:hover {
            background: #5a6268;
        }
        .error-func-btn.active {
            background: #007bff;
            border-color: #0056b3;
        }

        /* Dither method navigation */
        .dither-nav {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 0.25rem;
        }
        .dither-method-label {
            font-size: 0.75rem;
            min-width: 90px;
            text-align: center;
            white-space: nowrap;
        }

        /* System selector sidebar - always visible on desktop */
        .system-sidebar {
            position: fixed;
            top: 0;
            right: 0;
            width: 280px;
            height: 100vh;
            background: #343a40;
            z-index: 1050;
            overflow-y: auto;
            padding: 1rem;
            box-shadow: -2px 0 10px rgba(0,0,0,0.3);
        }
        .system-sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            color: #fff;
        }
        .system-sidebar-header h5 {
            margin: 0;
        }
        .system-sidebar-close {
            background: none;
            border: none;
            color: #fff;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            line-height: 1;
            display: none;  /* Hidden by default (desktop) */
        }
        .system-sidebar-close:hover {
            color: #adb5bd;
        }
        /* Sidebar overlays content on desktop */
        @media (min-width: 992px) {
            body.full-screen-container {
                padding-right: 0;
            }
            #systemSelectorToggle {
                display: none;
            }
            /* Sidebar collapse toggle for desktop */
            .sidebar-collapse-toggle {
                background: #495057;
                border: 1px solid #6c757d;
                color: #fff;
                padding: 0.25rem 0.5rem;
                border-radius: 0.25rem;
                cursor: pointer;
                font-size: 0.8rem;
            }
            .sidebar-collapse-toggle:hover {
                background: #5a6268;
            }
            .system-sidebar {
                transition: right 0.3s ease, opacity 0.3s ease;
            }
            .system-sidebar.collapsed {
                right: -280px;
                opacity: 0;
                pointer-events: none;
            }
            /* Show expand button when sidebar is collapsed */
            .sidebar-expand-btn {
                position: fixed;
                top: 10px;
                right: 10px;
                z-index: 1040;
                background: #343a40;
                border: 1px solid #6c757d;
                color: #fff;
                padding: 0.5rem;
                border-radius: 0.25rem;
                cursor: pointer;
                display: none;
            }
            .sidebar-expand-btn:hover {
                background: #495057;
            }
            body.sidebar-collapsed .sidebar-expand-btn {
                display: block;
            }
        }
        /* Mobile: hide sidebar, show toggle button */
        @media (max-width: 991px) {
            .system-sidebar {
                right: -280px;
                transition: right 0.3s ease;
            }
            .system-sidebar.open {
                right: 0;
            }
            .system-sidebar-close {
                display: block;
            }
            .system-sidebar-backdrop {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                z-index: 1040;
                display: none;
            }
            .system-sidebar-backdrop.open {
                display: block;
            }
        }
        #systemSearch {
            width: 100%;
            background: #495057;
            border: 1px solid #6c757d;
            color: #fff;
            padding: 0.5rem;
            border-radius: 0.25rem;
            margin-bottom: 0.75rem;
        }
        #systemSearch::placeholder {
            color: #adb5bd;
        }
        .sidebar-tabs {
            display: flex;
            margin-bottom: 0.75rem;
            border-bottom: 1px solid #6c757d;
        }
        .sidebar-tab {
            flex: 1;
            padding: 0.5rem;
            background: transparent;
            border: none;
            color: #adb5bd;
            font-size: 0.85rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.15s ease;
        }
        .sidebar-tab:hover {
            color: #fff;
            background: rgba(255,255,255,0.05);
        }
        .sidebar-tab.active {
            color: #fff;
            border-bottom-color: #007bff;
        }
        .sidebar-tab-content {
            display: none;
            overflow-y: auto;
            flex: 1;
        }
        .sidebar-tab-content.active {
            display: block;
        }
        .sidebar-sub-systems {
            display: none;
            margin-top: 0.25rem;
            padding: 0.25rem;
            background: rgba(0,0,0,0.2);
            border-radius: 0.25rem;
        }
        .sidebar-sub-systems.visible {
            display: block;
        }
        /* Inline sub-systems that appear directly below parent button */
        .sidebar-sub-systems-inline {
            margin: 0.25rem 0 0.25rem 0.75rem;
            padding: 0.25rem;
            background: rgba(0,0,0,0.15);
            border-left: 2px solid #007bff;
            border-radius: 0 0.25rem 0.25rem 0;
        }
        .sidebar-sub-systems-inline.visible {
            display: block;
        }
        .sidebar-sub-system-btn {
            display: block;
            width: 100%;
            text-align: left;
            padding: 0.3rem 0.5rem;
            font-size: 0.75rem;
            background: #5a6268;
            border: 1px solid #6c757d;
            color: #fff;
            margin-bottom: 0.2rem;
            border-radius: 0.2rem;
            cursor: pointer;
        }
        .sidebar-sub-system-btn:hover {
            background: #6c757d;
        }
        .sidebar-sub-system-btn.active {
            background: #0069d9;
            border-color: #0056b3;
        }
        .system-btn {
            display: block;
            width: 100%;
            text-align: left;
            padding: 0.4rem 0.5rem;
            font-size: 0.8rem;
            background: #495057;
            border: 1px solid #6c757d;
            color: #fff;
            margin-bottom: 0.25rem;
            border-radius: 0.25rem;
            cursor: pointer;
        }
        .system-btn:hover {
            background: #5a6268;
        }
        .system-btn.active {
            background: #007bff;
            border-color: #0056b3;
        }
        .system-btn.keyboard-highlight,
        .sidebar-sub-system-btn.keyboard-highlight {
            outline: 2px solid #ffc107;
            outline-offset: 1px;
            z-index: 1;
        }
        .system-btn.d-none {
            display: none !important;
        }
        #systemSelectorToggle {
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Palette swatches */
        .palette-swatch {
            display: block;
            width: 100%;
            height: 1.5em;
            border: 1px solid #333;
            margin-bottom: 2px;
            break-inside: avoid;
        }
        .palette-swatch-clickable {
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
        }
        .palette-swatch-clickable:hover {
            transform: scale(1.15);
            box-shadow: 0 2px 8px rgba(0,0,0,0.4);
            z-index: 1;
            position: relative;
        }
        .palette-swatch-clickable.picker-active {
            transform: scale(1.2);
            box-shadow: 0 0 0 2px #007bff, 0 2px 8px rgba(0,0,0,0.4);
            z-index: 2;
            position: relative;
        }
        /* Hidden color picker input - triggered programmatically */
        .color-picker-hidden {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
            pointer-events: none;
        }
        #resetPaletteBtn {
            display: block;
            margin: 0.5rem auto 0;
        }

        /* Responsive improvements */
        @media (max-width: 767px) {
            .main-layout {
                flex-direction: column;
                gap: 0.5rem;
            }
            .layout-column {
                flex: none;
            }
            .column-image {
                min-height: 30vh;
            }
            .dither-btn-group {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
            }
            /* Info column becomes horizontal row on mobile */
            .info-column {
                flex: none;
                max-width: 100%;
                width: 100%;
                padding: 0.5rem;
            }
            .info-panel {
                flex-direction: row;
                flex-wrap: wrap;
                align-items: center;
                justify-content: center;
                gap: 0.75rem;
            }
            .palette-swatches-vertical {
                column-count: auto;
                display: flex;
                flex-direction: row;
                flex-wrap: wrap;
                gap: 2px;
            }
            .palette-swatch {
                width: 2em;
                margin-bottom: 0;
            }
        }
        @media (max-width: 400px) {
            .error-func-group {
                flex-direction: column;
            }
            .error-func-btn {
                width: 100%;
                text-align: center;
            }
        }

        /* Animation controls */
        .animation-controls {
            display: none;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: #f8f9fa;
            border-radius: 0.25rem;
            margin-top: 0.5rem;
        }
        .animation-controls.visible {
            display: flex;
        }
        .animation-controls .btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.85rem;
        }
        .animation-controls .frame-slider {
            flex: 1;
            min-width: 100px;
        }
        .animation-controls .frame-counter {
            font-size: 0.75rem;
            color: #6c757d;
            white-space: nowrap;
            min-width: 50px;
            text-align: center;
        }
        .processing-control {
            display: none;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            margin-top: 0.25rem;
        }
        .source-playback-controls {
            display: none;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem;
            margin-top: 0.5rem;
        }
        .source-playback-controls.visible {
            display: flex;
        }
        .source-frame-counter {
            font-size: 0.75rem;
            color: #6c757d;
            min-width: 40px;
            text-align: center;
        }
        .source-gif-canvas {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .source-gif-canvas.visible {
            display: block;
        }
        .processing-progress {
            display: none;
            font-size: 0.75rem;
            color: #6c757d;
        }
        .processing-progress.visible {
            display: inline;
        }
        .processing-progress .progress {
            height: 4px;
            width: 100px;
            display: inline-block;
            vertical-align: middle;
            margin-left: 0.5rem;
        }
        /* Palette lock checkbox for animations */
        .palette-consistency-option {
            display: none;
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }
        .palette-consistency-option.visible {
            display: block;
        }
        .palette-consistency-option label {
            cursor: pointer;
        }

    </style>
</head>
<!-- body -->

<body class="full-screen-container">
    <div class="container-xl">

        <nav class="navbar">
            <a class="navbar-brand text-dark" href="#">DITHERTRON 2.0</a>
            <div class="navbar-actions ml-auto">
                <input type="file" id="imageUpload" class="file-input-sm">
                <button id="prevExampleBtn" class="btn btn-secondary btn-sm" title="Previous example">
                    <i class="fa fa-chevron-left"></i>
                </button>
                <button id="nextExampleBtn" class="btn btn-secondary btn-sm" title="Next example">
                    <i class="fa fa-chevron-right"></i>
                </button>
                <span class="navbar-divider"></span>
                <button id="downloadImageBtn" type="button" class="btn btn-secondary btn-sm"
                    title="Download image"><span id="downloadBtnText">PNG</span> <i class="fa fa-download"></i></button>
                <button id="downloadFrameBtn" type="button" class="btn btn-secondary btn-sm" style="display:none;"
                    title="Download current frame as PNG">Frame PNG <i class="fa fa-download"></i></button>
                <button id="copyImageBtn" type="button" class="btn btn-secondary btn-sm"
                    title="Copy image to clipboard"><i class="fa fa-clipboard"></i> Copy</button>
                <button id="systemSelectorToggle" type="button" class="btn btn-primary btn-sm" title="Select target format">
                    <span id="currentSystemName">Select System</span> <i class="fa fa-chevron-right"></i>
                </button>
            </div>
        </nav>

        <!-- Main two-column layout -->
        <div class="main-layout">
            <!-- Left Column: Source Image -->
            <div class="layout-column">
                <div class="column-image">
                    <div class="image-container">
                        <img class="crop" id="srcimage">
                        <canvas id="sourceGifCanvas" class="source-gif-canvas"></canvas>
                    </div>
                </div>
                <!-- Source playback controls -->
                <div id="sourcePlaybackControls" class="source-playback-controls">
                    <button id="sourcePlayPauseBtn" class="btn btn-sm btn-secondary">
                        <i class="fa fa-play"></i>
                    </button>
                    <span id="sourceFrameCounter" class="source-frame-counter">1 / 1</span>
                </div>
                <div class="column-bottom">
                    <div class="alert alert-secondary">
                        <div class="row align-items-center" id="brightSection">
                            <label for="brightSlider" class="col-sm-3 col-form-label">Bright:</label>
                            <div class="col-sm-5 col-md-5">
                                <input type="range" id="brightSlider" data-provide="slider" data-slider-min="0"
                                    data-slider-max="100" data-slider-value="50" />
                            </div>
                            <div class="col-sm-4 col-md-4 text-right">
                                <button id="cropToggle" type="button" class="btn btn-outline-secondary btn-sm" title="Enable crop tool to adjust source image area">
                                    <i class="fa fa-crop"></i> Crop
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-secondary" id="resetSourceSliders">Reset</button>
                            </div>
                        </div>
                        <div class="row align-items-center" id="contrastSection">
                            <label for="contrastSlider" class="col-sm-3 col-form-label">Contrast:</label>
                            <div class="col-sm-5 col-md-5">
                                <input type="range" id="contrastSlider" data-provide="slider" data-slider-min="0"
                                    data-slider-max="100" data-slider-value="50" />
                            </div>
                        </div>
                        <div class="row align-items-center" id="saturationSection">
                            <label for="saturationSlider" class="col-sm-3 col-form-label">Color:</label>
                            <div class="col-sm-5 col-md-5">
                                <input type="range" id="saturationSlider" data-provide="slider" data-slider-min="0"
                                    data-slider-max="100" data-slider-value="50" />
                            </div>
                        </div>
                        <div class="row mt-2" id="errorFuncSection">
                            <div class="col-12">
                                <div class="error-func-group" id="errorFuncGroup" role="group">
                                    <!-- Error function buttons populated by JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Middle Column: Rendered Image -->
            <div class="layout-column">
                <div class="column-image">
                    <div class="image-container rendered-container">
                        <canvas id="destcanvas" class="rendered-canvas"></canvas>
                    </div>
                </div>
                <!-- Animation Controls -->
                <div id="animationControls" class="animation-controls">
                    <button id="playPauseBtn" class="btn btn-sm btn-secondary" title="Play/Pause animation">
                        <i class="fa fa-play"></i>
                    </button>
                    <input type="range" id="frameSlider" class="frame-slider" min="0" value="0" step="1">
                    <span id="frameCounter" class="frame-counter">1 / 1</span>
                    <span id="processingProgress" class="processing-progress">
                        Processing: <span id="progressText">0%</span>
                        <div class="progress">
                            <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%"></div>
                        </div>
                    </span>
                </div>
                <!-- Processing Control -->
                <div id="processingControl" class="processing-control" style="display:none;">
                    <button id="processAllFramesBtn" class="btn btn-primary btn-sm">
                        <i class="fa fa-cogs"></i> Process <span id="remainingFrameCount">0</span> Frames
                    </button>
                    <button id="cancelProcessingBtn" class="btn btn-secondary btn-sm" style="display:none;">
                        <i class="fa fa-stop"></i> Cancel
                    </button>
                </div>
                <div class="column-bottom">
                    <div class="alert alert-secondary">
                        <div class="row align-items-center" id="diversitySection">
                            <label for="diversitySlider" class="col-sm-3 col-form-label">Diversity:</label>
                            <div class="col-sm-5 col-md-5">
                                <input type="range" id="diversitySlider" data-provide="slider" data-slider-min="0"
                                    data-slider-max="100" data-slider-value="60" />
                            </div>
                            <div class="col-sm-4 col-md-4 text-right">
                                <button type="button" class="btn btn-sm btn-outline-secondary" id="resetDitherSliders">Reset</button>
                            </div>
                        </div>
                        <div class="row align-items-center" id="orderedSection">
                            <label for="orderedSlider" class="col-sm-3 col-form-label">Ordered:</label>
                            <div class="col-sm-5 col-md-5">
                                <input type="range" id="orderedSlider" data-provide="slider" data-slider-min="0"
                                    data-slider-max="100" data-slider-value="0" />
                            </div>
                        </div>
                        <div class="row align-items-center" id="noiseSection">
                            <label for="noiseSlider" class="col-sm-3 col-form-label">Noise:</label>
                            <div class="col-sm-5 col-md-5">
                                <input type="range" id="noiseSlider" data-provide="slider" data-slider-min="0"
                                    data-slider-max="10" data-slider-value="5" />
                            </div>
                        </div>
                        <div class="row align-items-center" id="diffuseSection">
                            <label for="diffuseSlider" class="col-sm-3 col-form-label">Diffusion:</label>
                            <div class="col-sm-5 col-md-5">
                                <input type="range" id="diffuseSlider" data-provide="slider" data-slider-min="0"
                                    data-slider-max="100" data-slider-value="75" />
                            </div>
                            <div class="col-sm-4 col-md-4 text-right dither-nav">
                                <button type="button" class="btn btn-sm btn-outline-secondary" id="prevDitherBtn" title="Previous dither method">
                                    <i class="fa fa-chevron-left"></i>
                                </button>
                                <span id="diffMethodLabel" class="dither-method-label">Floyd-Steinberg</span>
                                <button type="button" class="btn btn-sm btn-outline-secondary" id="nextDitherBtn" title="Next dither method">
                                    <i class="fa fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: System Info & Palette -->
            <div class="info-column">
                <div class="info-panel">
                    <div id="currentSystemDisplay" class="system-name-display"></div>
                    <div id="targetFormatInfo" class="format-info"></div>
                    <div id="paletteControls" class="palette-controls"></div>
                    <div id="paletteSwatches" class="palette-swatches-vertical"></div>
                    <div id="paletteConsistencyOption" class="palette-consistency-option">
                        <label>
                            <input type="checkbox" id="consistentPaletteCheckbox" checked>
                            Consistent palette
                        </label>
                    </div>
                </div>
            </div>
        </div>
        <!-- hidden canvas-->
        <canvas id="resizecanvas" style="display:none">
        <!-- hidden form -->
        <FORM action="https://8bitworkshop.com/redir.html" method="GET" id="ideForm" target="_ide">
        </FORM>
        <script>
            if (window.location.host == ('localhost:8000')) {
                document.forms['ideForm'].action = '/';
            }
        </script>
    </div>

    <!-- Footer -->
    <footer class="page-footer">
        <a href="https://github.com/sehugg/dithertron#dithertron" target="_github">README</a>
        <span class="footer-separator">|</span>
        <div class="dropdown d-inline-block">
            <a href="#" class="dropdown-toggle dropup-caret" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Books</a>
            <div class="dropdown-menu dropdown-menu-right">
                <a class="dropdown-item" target="_book_a2600"
                    href="https://www.amazon.com/gp/product/1541021304/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=B01N4DSRIZ">
                    <img src="images/books/book_a2600.png" />
                    Making Games For The Atari 2600
                </a>
                <a class="dropdown-item" target="_book_arcade"
                    href="https://www.amazon.com/gp/product/1545484759/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=1545484759">
                    <img src="images/books/book_arcade.png" />
                    Making 8-bit Arcade Games in C
                </a>
                <a class="dropdown-item" target="_book_verilog"
                    href="https://www.amazon.com/gp/product/1728619440/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=1728619440">
                    <img src="images/books/book_verilog.png" />
                    Designing Video Game Hardware in Verilog
                </a>
                <a class="dropdown-item" target="_book_nes"
                    href="https://www.amazon.com/gp/product/1075952727/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=1075952727">
                    <img src="images/books/book_nes.png" />
                    Making Games For The NES
                </a>
            </div>
        </div>
    </footer>

    <!-- System selector sidebar -->
    <div class="system-sidebar-backdrop" id="systemSidebarBackdrop"></div>
    <button class="sidebar-expand-btn" id="sidebarExpandBtn" title="Show system sidebar">
        <i class="fa fa-list"></i> Systems
    </button>
    <div class="system-sidebar" id="systemSidebar">
        <div class="system-sidebar-header">
            <h5>Select System</h5>
            <button class="sidebar-collapse-toggle" id="sidebarCollapseToggle" title="Hide sidebar">
                <i class="fa fa-chevron-right"></i>
            </button>
            <button class="system-sidebar-close" id="systemSidebarClose">&times;</button>
        </div>
        <input type="text" id="systemSearch" placeholder="Search systems...">
        <div class="sidebar-tabs">
            <button type="button" class="sidebar-tab active" data-sidebar-tab="defaults">Defaults</button>
            <button type="button" class="sidebar-tab" data-sidebar-tab="extended">Extended</button>
        </div>
        <div class="sidebar-tab-content active" data-sidebar-tab-content="defaults">
            <div id="sidebarDefaultsButtons">
                <!-- Defaults systems populated by JS -->
            </div>
            <div id="sidebarDefaultsSubSystems" class="sidebar-sub-systems">
                <!-- Sub-systems populated by JS -->
            </div>
        </div>
        <div class="sidebar-tab-content" data-sidebar-tab-content="extended">
            <div id="sidebarExtendedButtons">
                <!-- Extended systems populated by JS -->
            </div>
        </div>
    </div>

    <!-- local scripts-->
    <script src="gen/ui.js" type="module"></script>

</body>
</html>
