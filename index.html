<!DOCTYPE html>
<html>
<head>
    <script src="lib/jquery.min.js"></script>
    <script src="lib/bootstrap.bundle.min.js"></script>
    <script src="lib/bootstrap-slider.min.js"></script>
    <!-- css -->
    <link rel="stylesheet" href="lib/font-awesome.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="lib/bootstrap.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="lib/cropper.min.css">
    <link rel="stylesheet" href="lib/bootstrap-slider.min.css">
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- twitter tags-->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@8bitworkshop">
    <meta name="twitter:creator" content="@8bitworkshop">
    <meta name="twitter:image" content="https://8bitworkshop.com/blog/images/ide/dithertron-compare.png">
    <meta name="twitter:title" content="Dithertron by 8bitworkshop">
    <meta name="twitter:description" content="Crop, reduce, and dither images to 8-bit retro formats.">
    <title>Dithertron</title>
    <!-- local CSS -->
    <style type="text/css" media="screen">
        /* Footer styles - fixed at bottom of viewport */
        .page-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 280px; /* Account for sidebar on desktop */
            text-align: center;
            padding: 0.5rem 1rem;
            color: #6c757d;
            font-size: 0.85rem;
            background: rgba(255,255,255,0.95);
            border-top: 1px solid #dee2e6;
            z-index: 1000;
        }
        .page-footer a {
            color: #6c757d;
            text-decoration: none;
        }
        .page-footer a:hover {
            color: #343a40;
            text-decoration: underline;
        }
        .footer-separator {
            margin: 0 0.5rem;
            color: #adb5bd;
        }
        .page-footer .dropdown-menu {
            font-size: 0.85rem;
        }
        .page-footer .dropdown-item img {
            height: 2em;
            margin-right: 0.5rem;
        }
        @media (max-width: 991px) {
            .page-footer {
                right: 0; /* Full width on mobile */
            }
        }
        /* Custom CSS to make the container full-screen on desktop */
        @media (min-width: 768px) {
            .full-screen-container {
                height: 100vh;
                display: flex;
                align-items: center;
            }
            .container-xl {
                height: 100vh;
                display: flex;
                flex-direction: column;
                padding-bottom: 3rem; /* Space for fixed footer */
            }
            .responsive-row {
                display: flex;
                height: 50vh;
            }
            .responsive-col {
                display: flex;
                flex-direction: column;
            }
        }
        /* Main layout structure */
        .container-xl {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding-bottom: 2.5rem; /* Space for fixed footer */
        }
        .main-layout {
            display: flex;
            flex: 1;
            gap: 1rem; /* Gutter between columns */
            min-height: 0; /* Allow flex children to shrink */
            padding: 0 0.5rem;
        }
        .layout-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0; /* Allow flex children to shrink */
        }
        .column-top {
            flex-shrink: 0;
        }
        .column-top .alert {
            margin-bottom: 0.5rem;
        }
        .column-image {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 0; /* Critical for flex shrinking */
            overflow: hidden;
        }
        .image-container {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .column-bottom {
            flex-shrink: 0;
        }
        .column-bottom .alert {
            margin-bottom: 0;
            margin-top: 0.5rem;
        }

        /* Source image (cropper) - always fill width */
        .image-container:not(.rendered-container) {
            align-items: flex-start;
            overflow-y: auto;
            background: #fff;
        }
        img.crop {
            display: block;
            width: 100%;
        }
        /* Override cropper.js grid background */
        .cropper-bg {
            background-image: none;
            background-color: #fff;
        }

        /* Rendered image (canvas) */
        .rendered-container {
            flex-direction: column;
            align-items: flex-start;
            overflow-y: auto;
        }
        .rendered-canvas {
            display: block;
            width: 100%;
            height: auto;
            background: #000;
        }
        .palette-swatches-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            width: 100%;
            margin-top: 0.5rem;
        }
        #booksMenu {
            background-color: #666;
            border-radius: 0.5em;
        }
        #booksMenu > a {
            color: #fff;
        }
        #examplesMenu {
            font-size: 0.8em;
        }
        /* Compact alert styling */
        .column-top .alert,
        .column-bottom .alert {
            padding: 0.5rem 0.75rem;
        }
        /* Slider panel header with reset button */
        .slider-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            padding-bottom: 0.25rem;
            border-bottom: 1px solid #dee2e6;
        }
        .slider-panel-title {
            font-weight: 500;
            font-size: 0.85rem;
            color: #495057;
        }
        /* Letterbox toggle button */
        #letterboxToggle.active {
            background: #007bff;
            border-color: #007bff;
            color: #fff;
        }

        /* Error function buttons */
        .error-func-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
        }
        .error-func-btn {
            padding: 0.2rem 0.5rem;
            font-size: 0.7rem;
            background: #495057;
            border: 1px solid #6c757d;
            color: #fff;
            border-radius: 0.25rem;
            cursor: pointer;
            white-space: nowrap;
        }
        .error-func-btn:hover {
            background: #5a6268;
        }
        .error-func-btn.active {
            background: #007bff;
            border-color: #0056b3;
        }

        /* Dither algorithm grid */
        .dither-btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
        }
        .dither-btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            background: #495057;
            border: 1px solid #6c757d;
            color: #fff;
            border-radius: 0.25rem;
            cursor: pointer;
            white-space: nowrap;
        }
        .dither-btn:hover {
            background: #5a6268;
        }
        .dither-btn.active {
            background: #007bff;
            border-color: #0056b3;
        }

        /* System selector sidebar - always visible on desktop */
        .system-sidebar {
            position: fixed;
            top: 0;
            right: 0;
            width: 280px;
            height: 100vh;
            background: #343a40;
            z-index: 1050;
            overflow-y: auto;
            padding: 1rem;
            box-shadow: -2px 0 10px rgba(0,0,0,0.3);
        }
        .system-sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            color: #fff;
        }
        .system-sidebar-header h5 {
            margin: 0;
        }
        .system-sidebar-close {
            background: none;
            border: none;
            color: #fff;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            line-height: 1;
            display: none;  /* Hidden by default (desktop) */
        }
        .system-sidebar-close:hover {
            color: #adb5bd;
        }
        /* Body padding to make room for sidebar on desktop */
        @media (min-width: 992px) {
            body.full-screen-container {
                padding-right: 280px;
            }
            #systemSelectorToggle {
                display: none;
            }
        }
        /* Mobile: hide sidebar, show toggle button */
        @media (max-width: 991px) {
            .system-sidebar {
                right: -280px;
                transition: right 0.3s ease;
            }
            .system-sidebar.open {
                right: 0;
            }
            .system-sidebar-close {
                display: block;
            }
            .system-sidebar-backdrop {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                z-index: 1040;
                display: none;
            }
            .system-sidebar-backdrop.open {
                display: block;
            }
        }
        #systemSearch {
            width: 100%;
            background: #495057;
            border: 1px solid #6c757d;
            color: #fff;
            padding: 0.5rem;
            border-radius: 0.25rem;
            margin-bottom: 1rem;
        }
        #systemSearch::placeholder {
            color: #adb5bd;
        }
        .system-btn {
            display: block;
            width: 100%;
            text-align: left;
            padding: 0.4rem 0.5rem;
            font-size: 0.8rem;
            background: #495057;
            border: 1px solid #6c757d;
            color: #fff;
            margin-bottom: 0.25rem;
            border-radius: 0.25rem;
            cursor: pointer;
        }
        .system-btn:hover {
            background: #5a6268;
        }
        .system-btn.active {
            background: #007bff;
            border-color: #0056b3;
        }
        .system-btn.d-none {
            display: none !important;
        }
        #systemSelectorToggle {
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Palette swatches */
        .palette-swatch {
            display: inline-block;
            width: 2em;
            height: 1.5em;
            border: 1px solid #333;
            margin: 2px;
        }
        .palette-swatch-clickable {
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
        }
        .palette-swatch-clickable:hover {
            transform: scale(1.15);
            box-shadow: 0 2px 8px rgba(0,0,0,0.4);
            z-index: 1;
            position: relative;
        }
        #resetPaletteBtn {
            display: block;
            margin: 0.5rem auto 0;
        }

        /* Color picker panel */
        .color-picker-panel {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: #343a40;
            border: 1px solid #6c757d;
            border-radius: 0.25rem;
            padding: 0.35rem 0.5rem;
            margin-left: 0.5rem;
            vertical-align: middle;
        }
        .color-picker-input {
            width: 2.5rem;
            height: 2rem;
            padding: 0;
            border: none;
            cursor: pointer;
        }

        /* Responsive improvements */
        @media (max-width: 767px) {
            .main-layout {
                flex-direction: column;
                gap: 0.5rem;
            }
            .layout-column {
                flex: none;
            }
            .column-image {
                min-height: 30vh;
            }
            .dither-btn-group {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
            }
        }
        @media (max-width: 400px) {
            .error-func-group {
                flex-direction: column;
            }
            .error-func-btn {
                width: 100%;
                text-align: center;
            }
        }
    </style>
</head>
<!-- body -->

<body class="full-screen-container">
    <div class="container-xl">

        <nav class="navbar justify-content-center">
            <a class="navbar-brand text-dark" href="#">DITHERTRON 2.0</a>
        </nav>

        <!-- Main two-column layout -->
        <div class="main-layout">
            <!-- Left Column: Source Image -->
            <div class="layout-column">
                <div class="column-top">
                    <div class="alert alert-info">
                        <a class="btn btn-secondary dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Select an example
                        </a> or upload an image.
                        <div class="dropdown-menu" aria-labelledby="dropdownMenuLink" id="examplesMenu">
                        </div>
                        <div class="mt-2">
                            <input type="file" id="imageUpload">
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="alert alert-info">
                    Convert to:
                    <button id="systemSelectorToggle" type="button" class="btn btn-primary btn-sm" title="Select target format">
                        <span id="currentSystemName">Select System</span> <i class="fa fa-chevron-right"></i>
                    </button>
                    <button id="letterboxToggle" type="button" class="btn btn-outline-secondary btn-sm ml-2" title="Toggle letterbox mode (fit image without cropping)">
                        <i class="fa fa-arrows-alt"></i> Letterbox
                    </button>
                    <br>
                    <small><span id="targetFormatInfo"></span></small>
                    <br>
                    <div>
                        <button id="downloadImageBtn" type="button" class="btn btn-secondary btn-sm"
                            title="Download a PNG image">PNG <i class="fa fa-download"></i></button>
                        <button id="copyImageBtn" type="button" class="btn btn-secondary btn-sm"
                            title="Copy image to clipboard"><i class="fa fa-clipboard"></i> Copy</button>
                    </div>
                </div>
                <div class="column-bottom">
                    <div class="alert alert-secondary">
                        <div class="slider-panel-header">
                            <span class="slider-panel-title">Source Adjustments</span>
                            <button type="button" class="btn btn-sm btn-outline-secondary" id="resetSourceSliders">Reset</button>
                        </div>
                        <div class="row align-items-center" id="brightSection">
                            <label for="brightSlider" class="col-sm-3 col-form-label">Bright:</label>
                            <div class="col-sm-5 col-md-5">
                                <input type="range" id="brightSlider" data-provide="slider" data-slider-min="0"
                                    data-slider-max="100" data-slider-value="50" />
                            </div>
                        </div>
                        <div class="row align-items-center" id="contrastSection">
                            <label for="contrastSlider" class="col-sm-3 col-form-label">Contrast:</label>
                            <div class="col-sm-5 col-md-5">
                                <input type="range" id="contrastSlider" data-provide="slider" data-slider-min="0"
                                    data-slider-max="100" data-slider-value="50" />
                            </div>
                        </div>
                        <div class="row align-items-center" id="saturationSection">
                            <label for="saturationSlider" class="col-sm-3 col-form-label">Color:</label>
                            <div class="col-sm-5 col-md-5">
                                <input type="range" id="saturationSlider" data-provide="slider" data-slider-min="0"
                                    data-slider-max="100" data-slider-value="50" />
                            </div>
                        </div>
                        <div class="row mt-2" id="errorFuncSection">
                            <div class="col-12">
                                <div class="error-func-group" id="errorFuncGroup" role="group">
                                    <!-- Error function buttons populated by JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Rendered Image -->
            <div class="layout-column">
                <div class="column-top">
                    <div class="alert alert-info">
                        Convert to:
                        <button id="systemSelectorToggle" type="button" class="btn btn-primary btn-sm" title="Select target format">
                            <span id="currentSystemName">Select System</span> <i class="fa fa-chevron-right"></i>
                        </button>
                        <button id="letterboxToggle" type="button" class="btn btn-outline-secondary btn-sm ml-2" title="Toggle letterbox mode (fit image without cropping)">
                            <i class="fa fa-arrows-alt"></i> Letterbox
                        </button>
                        <br>
                        <small><span id="targetFormatInfo"></span></small>
                        <div class="mt-1">
                            <button id="downloadImageBtn" type="button" class="btn btn-secondary btn-sm"
                                title="Download a PNG image">PNG <i class="fa fa-download"></i></button>
                            <button id="copyImageBtn" type="button" class="btn btn-secondary btn-sm"
                                title="Copy image to clipboard"><i class="fa fa-clipboard"></i> Copy</button>
                        </div>
                    </div>
                </div>
                <div class="column-image">
                    <div class="image-container rendered-container">
                        <canvas id="destcanvas" class="rendered-canvas"></canvas>
                        <div id="paletteSwatches" class="palette-swatches-container">
                        </div>
                    </div>
                </div>
                <div class="column-bottom">
                    <div class="alert alert-secondary">
                        <div class="slider-panel-header">
                            <span class="slider-panel-title">Dither Settings</span>
                            <button type="button" class="btn btn-sm btn-outline-secondary" id="resetDitherSliders">Reset</button>
                        </div>
                        <div class="row align-items-center" id="diversitySection">
                            <label for="diversitySlider" class="col-sm-3 col-form-label">Diversity:</label>
                            <div class="col-sm-5 col-md-5">
                                <input type="range" id="diversitySlider" data-provide="slider" data-slider-min="0"
                                    data-slider-max="100" data-slider-value="60" />
                            </div>
                        </div>
                        <div class="row align-items-center" id="orderedSection">
                            <label for="orderedSlider" class="col-sm-3 col-form-label">Ordered:</label>
                            <div class="col-sm-5 col-md-5">
                                <input type="range" id="orderedSlider" data-provide="slider" data-slider-min="0"
                                    data-slider-max="100" data-slider-value="0" />
                            </div>
                        </div>
                        <div class="row align-items-center" id="noiseSection">
                            <label for="noiseSlider" class="col-sm-3 col-form-label">Noise:</label>
                            <div class="col-sm-5 col-md-5">
                                <input type="range" id="noiseSlider" data-provide="slider" data-slider-min="0"
                                    data-slider-max="10" data-slider-value="5" />
                            </div>
                        </div>
                        <div class="row align-items-center" id="diffuseSection">
                            <label for="diffuseSlider" class="col-sm-3 col-form-label">Diffusion:</label>
                            <div class="col-sm-5 col-md-5">
                                <input type="range" id="diffuseSlider" data-provide="slider" data-slider-min="0"
                                    data-slider-max="100" data-slider-value="75" />
                            </div>
                        </div>
                        <div class="row mt-2" id="ditherButtonSection">
                            <div class="col-12">
                                <div class="dither-btn-group" id="ditherButtonGroup" role="group">
                                    <!-- Dither buttons populated by JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- hidden canvas-->
        <canvas id="resizecanvas" style="display:none">
        <!-- hidden form -->
        <FORM action="https://8bitworkshop.com/redir.html" method="GET" id="ideForm" target="_ide">
        </FORM>
        <script>
            if (window.location.host == ('localhost:8000')) {
                document.forms['ideForm'].action = '/';
            }
        </script>
    </div>

    <!-- Footer -->
    <footer class="page-footer">
        <a href="https://github.com/sehugg/dithertron#dithertron" target="_github">README</a>
        <span class="footer-separator">|</span>
        <div class="dropdown d-inline-block">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Books</a>
            <div class="dropdown-menu dropdown-menu-right">
                <a class="dropdown-item" target="_book_a2600"
                    href="https://www.amazon.com/gp/product/1541021304/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=B01N4DSRIZ">
                    <img src="images/books/book_a2600.png" />
                    Making Games For The Atari 2600
                </a>
                <a class="dropdown-item" target="_book_arcade"
                    href="https://www.amazon.com/gp/product/1545484759/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=1545484759">
                    <img src="images/books/book_arcade.png" />
                    Making 8-bit Arcade Games in C
                </a>
                <a class="dropdown-item" target="_book_verilog"
                    href="https://www.amazon.com/gp/product/1728619440/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=1728619440">
                    <img src="images/books/book_verilog.png" />
                    Designing Video Game Hardware in Verilog
                </a>
                <a class="dropdown-item" target="_book_nes"
                    href="https://www.amazon.com/gp/product/1075952727/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=1075952727">
                    <img src="images/books/book_nes.png" />
                    Making Games For The NES
                </a>
            </div>
        </div>
    </footer>

    <!-- System selector sidebar -->
    <div class="system-sidebar-backdrop" id="systemSidebarBackdrop"></div>
    <div class="system-sidebar" id="systemSidebar">
        <div class="system-sidebar-header">
            <h5>Select System</h5>
            <button class="system-sidebar-close" id="systemSidebarClose">&times;</button>
        </div>
        <input type="text" id="systemSearch" placeholder="Search systems...">
        <div class="system-category-accordion" id="systemAccordion">
            <!-- System categories populated by JS -->
        </div>
    </div>

    <!-- local scripts-->
    <script src="gen/ui.js" type="module"></script>

</body>
</html>
